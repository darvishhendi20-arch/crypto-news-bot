import requests
import schedule
import time
from googletrans import Translator
import telegram
import os

# ØªÙˆÚ©Ù† Ùˆ Ú†Øªâ€ŒØ¢ÛŒâ€ŒØ¯ÛŒ Ø´Ù…Ø§
BOT_TOKEN = "7750504733:AAHmIw6IS0DHjqDMuuarkguuvjiB0QM_ShA"
CHAT_ID = "6602124493"

bot = telegram.Bot(token=BOT_TOKEN)
translator = Translator()

# Ù„ÛŒØ³Øª Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§
SOURCES = [
    "https://api.rss2json.com/v1/api.json?rss_url=https://cointelegraph.com/rss",
    "https://api.rss2json.com/v1/api.json?rss_url=https://www.coindesk.com/arc/outboundfeeds/rss/"
]

def get_news():
    all_news = []
    for url in SOURCES:
        try:
            res = requests.get(url)
            data = res.json()
            for item in data['items'][:3]:
                title_fa = translator.translate(item['title'], src='en', dest='fa').text
                link = item['link']
                all_news.append(f"ðŸ“Œ {title_fa}\nðŸ”— {link}")
        except Exception as e:
            print("Error fetching:", e)
    return "\n\n".join(all_news)

def send_news():
    news_text = get_news()
    if news_text:
        bot.send_message(chat_id=CHAT_ID, text=f"ðŸ“° Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§Ø®Ø¨Ø§Ø± Ú©Ø±ÛŒÙ¾ØªÙˆ:\n\n{news_text}")

# Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ: Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª 9 ØµØ¨Ø­
schedule.every().day.at("09:00").do(send_news)

print("Ø±Ø¨Ø§Øª Ø§Ø¬Ø±Ø§ Ø´Ø¯...")

while True:
    schedule.run_pending()
    time.sleep(60)
